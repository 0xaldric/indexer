package known_test

import (
	"encoding/json"
	"math/big"
	"os"
	"testing"

	"github.com/stretchr/testify/require"
	"github.com/tonindexer/anton/abi"
	"github.com/tonindexer/anton/addr"
	"github.com/xssnick/tonutils-go/address"
)

func TestGetMethodDesc_TonfunFactory(t *testing.T) {
	var (
		interfaces []*abi.InterfaceDesc
		i          *abi.InterfaceDesc
	)

	j, err := os.ReadFile("tonfun.json")
	require.Nil(t, err)

	err = json.Unmarshal(j, &interfaces)
	require.Nil(t, err)

	for _, i = range interfaces {
		if i.Name == "tonfun_factory" {
			err := abi.RegisterDefinitions(i.Definitions)
			require.Nil(t, err)
			break
		}
	}
	
	var testCases = []*struct {
		name string
		addr *address.Address
		code string
		data string
		expected []any
	} {
		{
			name: "get_initial_ton_fun_data_parse",
			addr: addr.MustFromBase64("kQBf2Xc-07OLPlv4GNKQffy3rLuhRvXQQWLA7Dqiuh4kt5w4").MustToTonutils(),
			code: `te6ccgECIwEACCIAART/APSkE/S88sgLAQIBYgIDAgLLBAUCASAUFQLf0MyLHAJJfA+DQ0wMx+kD6QDH6ADFx1yH6ADH6ADBzqbQAA9Mf0z/tRND6QAH4YfoAAfhi+gAB+GPUAdDUAfhk1AH4ZdQw+Gb0BAH4Z9Qw0NQB+GnUMPhoIoIQX6WhaLrjAvhBUkDHBeMCXwaED/LwgYHAA2k6H0gfSBAApgyRADU0wfTAHBTAo4WW/oAJqcDUiCgggpiWgCgggiYloCgWN4jl4IKYloAIqCVggpiWgDiKKcF+EKgAaAZuY6KXwhwgEBysRLbPOMODQgCkF4ibEEhghC9WC1uuo64W/hB+EOAQHKxEts8cPhj+Ej4ScjMzMn4R/hG+EX4RMjMzMzJyPhBzxb4QvoC+EP6Asz0AMzJ7VTjDg0OAfz4R1JAePQPb6Hy4GIkwAKOHQL6QDAC8BlwB8jLBxfLAFjPFgHPFljPFlADzxbJkjIz4vhE0PoA+gD6APoA+gD6ANMPMPhIcPgo+EkQNEEwHlUgcATIUAT6AljPFszMySHIywET9AAS9ADLAMkg+QBwdMjLAsoHy//J0Pgo+EkJAvz4RSMQXxA0UMxwVHAALVHNDBC/EK4QSVCHEDYQXxAkED74RshQBc8WUAPPFszMychQDPoCUAr6AlAI+gJQBvoCUAT6Alj6AssPAfoCyw/LABLMzMkiyMsBEvQA9ADLAMkg+QBwdMjLAsoHy//J0IIImJaAVCIgyMkTcds8bSUMCgH+jhUwcMgszxZQC/oCcfoCK88WGssAyQmROuKCEE4L0CDIyx8j+gIi+gIVywAZ9ADJCKCCCJiWgFJwoFAEoIIImJaAUnCgIaCCCJiWgBigJ6BwghAXjUUZyMsfUoDLP1AG+gIjzxYVywEB+gIXzMmAFcjLHxXLPyHPFlAF+gITzAsByskkWXHbPAHIUAPPFgHPFgHPFsmCEAoIhVwBcIMHcYAMyMsDywHLCFIwy//LYRLLH8zJcPsA+EP4QqD4Y/hI+EnIzMzJ+Ef4RvhF+ETIzMzMycj4Qc8W+EL6AvhD+gLM9ADMye1UDAAud4AYyMsFUAXPFlAF+gITy2vMzMkB+wAAKHCAGMjLBVADzxZQA/oCy2rJAfsAAvwhghDlf0y9uo4vMfoAMPhi+Ej4ScjMzMn4R/hG+EX4RMjMzMzJyPhBzxb4QvoC+EP6Asz0AMzJ7VTgIYIQEd9+37qOLjHUMPhk+Ej4ScjMzMn4R/hG+EX4RMjMzMzJyPhBzxb4QvoC+EP6Asz0AMzJ7VTgIYIQ0AA9ubrjAiEPEABcMdQw+wT4SPhJyMzMyfhH+Eb4RfhEyMzMzMnI+EHPFvhC+gL4Q/oCzPQAzMntVAOwghCwfJPouo4vMfpAMPhh+Ej4ScjMzMn4R/hG+EX4RMjMzMzJyPhBzxb4QvoC+EP6Asz0AMzJ7VTgIYIQ/a4SArrjAiGCELsj7La64wIBghBWqxUvuuMCMBESEwB8MdMH1DD4R26Tbfhn3vhHEnj0F/hn+Ej4ScjMzMn4R/hG+EX4RMjMzMzJyPhBzxb4QvoC+EP6Asz0AMzJ7VQAgDHTBzD4R26Tbfhn3vhHePRbAfhn8uBj+Ej4ScjMzMn4R/hG+EX4RMjMzMzJyPhBzxb4QvoC+EP6Asz0AMzJ7VQAWtQw+GX4SPhJyMzMyfhH+Eb4RfhEyMzMzMnI+EHPFvhC+gL4Q/oCzPQAzMntVAIBIBYXAgEgHB0CAUgYGQCLu4tO1E0PpAAfhh+gAB+GL6AAH4Y9QB0NQB+GTUAfhl1DD4ZvQEAfhn1DDQ1AH4adQw+Gj4RND6APoA+gD6APoA+gDTDzCAICcxobAGux9btRND6QAH4YfoAAfhi+gAB+GPUAdDUAfhk1AH4ZdQw+Gb0BAH4Z9Qw0NQB+GnUMPho+ESAAxaAjtRND6QAH4YfoAAfhi+gAB+GPUAdDUAfhk1AH4ZdQw+Gb0BAH4Z9Qw0NQB+GnUMPho+EZwUwDIUAXPFiH6AhTLHyH6AhPLH8kiyMsBEvQA9ADLAMn5AHB0yMsCygfL/8nQgBxoae1E0PpAAfhh+gAB+GL6AAH4Y9QB0NQB+GTUAfhl1DD4ZvQEAfhn1DDQ1AH4adQw+Gj4QfhC+EOAvu4rM7UTQ+kAB+GH6AAH4YvoAAfhj1AHQ1AH4ZNQB+GXUMPhm9AQB+GfUMNDUAfhp1DD4aPhIcPgo+EkQNEEwFlUgcATIUAT6AljPFszMySHIywET9AAS9ADLAMn5AHB0yMsCygfL/8nQ+EdSIHj0D2+hI8ACkjMz4w0B8uBigeHwIBICEiADQB8BlwBsjLBxbLAFjPFgHPFlAEzxZYzxbJWQH8+ETQ+gAx+gAx+gD6APoA+gDTDzD4KPhJ+EUQeRBoEFcQRhA1QUATcFRwAC1RzQwQvxCuEElQhxA2EF8QJBA++EbIUAXPFlADzxbMzMnIUAz6AlAK+gJQCPoCUAb6AlAE+gJY+gLLDwH6AssPywASzMzJIsjLARL0APQAywDJIAAa+QBwdMjLAsoHy//J0AB7tbpdqJofSAA/DD9AAD8MX0AAPwx6gDoagD8MmoA/DLqGHwzegIA/DPqGGhqAPw06hh8NHwjvHoHt9D5cDFAAz7SOnaiaH0gAPww/QAA/DF9AAD8MeoA6GoA/DJqAPwy6hh8M3oCAPwz6hhoagD8NOoYfDR8JDh8FHwkiBogmCqQOAJkKAJ9ASxni2ZmZJDkZYCJ+gAJegBlgGT8gDg6ZGWBZQPl/+ToQ`,
			data: `te6ccgECXgEAE1QAA0WAD1Uy7olDGF9bGtFySIzrn0LZr3qp/xfYI7SRaXigkwZgGAECAwMACAkKAgHNBAUCAD4/AQFYBgEBSAcAAACHgBwELHuyqYexSPT5OLR78VkGoW/lA8kRsz0sqR4b8tGBcAMtxx7pJlbeWTf0y5snnnDm/wu34QGzrQRqnM3KsodDQCAAUICxorwuxQAACALGivC7FAAASy0F4AgCxorwuxQAAFA3gb9QAgPow1ABFP8A9KQT9LzyyAsLART/APSkE/S88sgLIwIBYgwNAgLKDg8CASAbHAIBIBARADGpVIyoFIioROoUyGooQKCEDuaygACqKmEgAgHOEkgCAnUZGgHxO2i7fsgxwCSXwTgAdDTAzH6QPpAMfoAMXHXIfoAMfoAMHOptAAC0x/TP+1E0PoAAfhh+gAB+GL6AAH4Y/oAAfhk+gAB+GX6AAH4ZtMPAfhn+gAB+GjTDwH4adMAAfhq1AHQ+kAB+Gv6QAH4bNQB+G3UMPhu1DD4b4BMDSIIQc2LQnFIwuuMAIoIQ7VkxNbrjAjQ0+EsSxwXjAl8EhA/y8BQVFgL++Cj4TPhNcFQgE1QUA8hQBPoCWM8WAc8WzMkiyMsBEvQA9ADLAMn5AHB0yMsCygfL/8nQUkDHBfLivvoA+kD4SsABjrkwMzQ1M3BZgEABECVwQGVwIIIQD4p+pcjLHxbLP1AD+gIhzxYBzxYTywAB+gLLAMkCcrFDMNs82zHg1D0pA4YyNfhKwAGOixRfBHCAQHKxEts84EMw+gD6APpA0wAlpwNSUKCCCmJaAKCCCJiWgKBScLmOjBB4XwhwgEBysRLbPOMONDQtA+gDMiKCEEEuGda6j2YwIYIQHpQjhrqOz1v4S/hHgEBysRLbPHD4Z/hP+E74Tcj4S88W+EzPFszMyfhK+En4R8j4QfoC+EL6AvhD+gL4RPoC+EX6AvhG+gLLD/hI+gLLD8sAzMzJ7VTgAYIQQqD7Q7rjAjDjDTQXGAFEggiYloD4R6D4QaBSELzy4FOCCJiWgPhHoPhBoKH4S3DbPDQAjmwh0w8w+Gf4T/hO+E3I+EvPFvhMzxbMzMn4SvhJ+EfI+EH6AvhC+gL4Q/oC+ET6AvhF+gL4RvoCyw/4SPoCyw/LAMzMye1UATUMYIQIc/gK8jLHxPLPwHPFsmCCvrwgFlx2zyA7ATkghCX1R8vyMsfFMs/Ac8WAc8WyYIK+vCAWXHbPIDsB57wwR2omh9AAD8MP0AAPwxfQAA/DH9AAD8Mn0AAPwy/QAA/DNph4D8M/0AAPw0aYeA/DTpgAD8NWoA6H0gAPw1/SAA/DZqAPw26hh8N2oYfDf8J7gpgGQoAueLEP0BCmWPkP0BCeWP5JFkZYCJegB6AGWAZMHQIBIB4fABr5AHB0yMsCygfL/8nQAgEgICEA0bsivtRND6AAH4YfoAAfhi+gAB+GP6AAH4ZPoAAfhl+gAB+GbTDwH4Z/oAAfho0w8B+GnTAAH4atQB0PpAAfhr+kAB+GzUAfht1DD4btQw+G/4QfhC+EP4RPhF+Eb4R/hI+En4SvhL+EyAHxtOYdqJofQAA/DD9AAD8MX0AAPwx/QAA/DJ9AAD8Mv0AAPwzaYeA/DP9AAD8NGmHgPw06YAA/DVqAOh9IAD8Nf0gAPw2agD8NuoYfDdqGHw3/COpCECTiFTCUPwhfCJQ/CD8ISkRVAFQ1IIpCFsEKQhQ0Pwg/CERLMCIAzbXWfaiaH0AAPww/QAA/DF9AAD8Mf0AAPwyfQAA/DL9AAD8M2mHgPwz/QAA/DRph4D8NOmAAPw1agDofSAA/DX9IAD8NmoA/DbqGHw3ahh8N/whfCCRLKkQVAFQVIJ8IXwgqoER+BLAAIFIgqAKgqQT4QfhCVQIj8CUCAWIkJQPg0CDHAJJfBOAB0NMDMfpAMAHTH9M/Me1E0PpAAfhh+gAB+GLTHwH4Y/oAAfhk0x8w+GUhghCjQaFwuuMCMDKCELL3e0T+IDCCELL3e0T+IDCCAeDz/iAwIYIQsvd7RLrjAjCCEEKg+0O64wIwhA/y8CYnKABJofXV2omh9IAD8MP0AAPwxaY+A/DH9AAD8MmmPmHwy/CD8IXwhwCCNFsB+gAwgggHoSBSEKASvPLixfhDpPhj+EIhoPhi+EWk+GX4RAGg+GT4RfhDyPhBzxb4QvoCyx/4RPoCyx/J7VQBZGwh+EHHBfLgSfhB+EKAQHKxEts8cPhicPhj+EX4Q8j4Qc8W+EL6Assf+ET6Assfye1UNAEyIIIImJaAvPLgU/hBAYIImJaAoXBysRLbPDQD/gHQI8IA8uLC0x8hghDUcAxBuo9iNls1NTUi8AFDAAH6APpAMPhC+EElWVIgqAKgqQRSA7n4QfhDoVIwvLGOs1twWYBAARAlcEBlcCCCEA+KfqXIyx8Wyz9QA/oCIc8WAc8WE8sAAfoCywDJAnKxQzDbPOMO2zHgM4IQTgvQILo9KisDuDI0UwNxcrES2zxwgEBysRLbPPhBI6H4YfhCIaD4YoIQTohCkEEz+ErI+EH6AvhC+gLLAMnIUAT6Alj6AgHPFszJcIMHcYAMyMsDywHLCFIwy//LYRLLH8zJcPsANDQsA7yP2TAzMzX6APoAUyGgFL7y4yP4Qlig+GL4RQGg+GXTAAGPNNQw0PpAQzD6APoA+kDTACWnA1JQoIIKYloAoIIImJaAoFJwuY6MEHhfCHCAQHKxEts84w6SXwTi4GwhNC0uAID4T/hO+E3I+EvPFvhMzxbMzMn4SvhJ+EfI+EH6AvhC+gL4Q/oC+ET6AvhF+gL4RvoCyw/4SPoCyw/LAMzMye1UA+b4R1JQgScQqYQimfhJUhCBJxCphJFw4mahU2Ch+EL4RKH4QfhCUiKoAqGpBFIQtghSEKFmofhB+EIiWVIgqAKgqQRSCbn4QvhEoVKQvLGOjBC8XwxwgEBysRLbPOAFkzhsIeMNUGShggiYloCh+Cj4TPhNNC8wAIT4T/hO+E3I+EvPFvhMzxbMzMn4SvhJ+EfI+EH6AvhC+gL4Q/oC+ET6AvhF+gL4RvoCyw/4SPoCyw/LAMzMye1U2zEBqgP6QDD4T3BTAMhQBc8WIfoCFMsfIfoCE8sfySLIywES9AD0AMsAySD5AHB0yMsCygfL/8nQUjqhgggtxsChghCjQaFwyMsfUtDLPwH6AskQKXDbPAUxAvxwVCATVBQDyFAE+gJYzxYBzxbMySLIywES9AD0AMsAyfkAcHTIywLKB8v/ydBwKQRDEyVZECVwQGVwIIIQD4p+pcjLHxbLP1AD+gIhzxYBzxYTywAB+gLLAMkCcrFDMNs8+EEkoPhh+EIhofhi+EhYoPho+EH4RoBQgGSphL49MgAud4AYyMsFUAXPFlAF+gITy2vMzMkB+wAD/o5O+E7Q0wfTACLAAgLAABKwjjn6QPpA+kD4TPpEccjLAxLLB8v/ydBUegEn8BpUGgol8BtxBMjLBxTLAFjPFgHPFgHPFlAFzxbJ+G6SWzTikTTi+EH4Rr74QvhEoYIQO5rKALuw4wAgwgCOiFIgcHKxEts8kTDighAjtJdhQTMzNDUCSo8i7aLt+3H4avhO0NMHIcABjoMx2zyOiwHAAo6E2zzbMeAw4tg2NwAocIAYyMsFUAPPFlAD+gLLaskB+wAA7PhKyPhB+gL4QvoCywDJyFAE+gJY+gIBzxbMyXCDB3GADMjLA8sBywhSMMv/y2ESyx/MyXD7APhP+E74Tcj4S88W+EzPFszMyfhK+En4R8j4QfoC+EL6AvhD+gL4RPoC+EX6AvhG+gLLD/hI+gLLD8sAzMzJ7VQB8vpA+kAw+Ez4TSNZcFQgE1QUA8hQBPoCWM8WAc8WzMkiyMsBEvQA9ADLAMn5AHB0yMsCygfL/8nQ+EH4Q6H4Rfgo+Ez4TXBUIBNUFAPIUAT6AljPFgHPFszJIsjLARL0APQAywDJ+QBwdMjLAsoHy//J0HAlRBNUR2A4Aaz6QDH6QPpA+Eb4Q6H4RfhM+kRxyMsDEssHy//J0Pgo+Ez4TXBUIBNUFAPIUAT6AljPFgHPFszJIsjLARL0APQAywDJ+QBwdMjLAsoHy//J0FRjMFRmSjoCmoIQ/Pnlj8jLH1jPFgH6AsmCEAjw0YBSMKCCCvrwgKBtcCCCEA+KfqXIyx/LP1AG+gJQBM8WFMsBEvQAghAI8NGA+gL0AMkScds8QTNxPTkBjoIQ/Pnlj8jLH1jPFgH6AsmCEAjw0YCCCvrwgKBtcCCCEA+KfqXIyx/LP1AG+gJQBM8WFMsBEvQAghAI8NGA+gL0AMkScds8PQKOyHH6AiX6AlAE+gLJghAI8NGAUlCgggr68ICgbW1wIIIQ1V5GhsjLH8s/UAn6AhjLAFAFzxZQA88WzBT0APQAyXHbPEVAQTA7PAAscYAQyMsFUATPFlAE+gISy2rMyQH7AAG4ghAI8NGAggr68ICgcFMAghBA4QjWyMsfywBQBc8WUAPPFnH6AlAH+gIl+gISywHLAcltcCCCEA+KfqXIyx/LP1AG+gJQA88WFMsB9ACCEAjw0YD6AhL0AMlx2zw9ACxxgBjIywVQBM8WUAT6AhLLaszJAfsAART/APSkE/S88sgLQAEU/wD0pBP0vPLIC1ECAWJBQgICy0NEABug9gXaiaH0AfSB9IGoYQIBIEVGAIPSAINch7UTQ+gD6QPpA1DAE0x+CEBeNRRlSILqCEHvdl94TuhKx8uLF0z8x+gAwE6BQI8hQBPoCWM8WAc8WzMntVICAdRHSAIBWElKAMMIMcAkl8E4AHQ0wMBcbCVE18D8BDg+kD6QDH6ADFx1yH6ADH6ADBzqbQAAtMfghAPin6lUiC6lTE0WfAN4IIQF41FGVIgupYxREQD8A7gNYIQWV8HvLqTWfAP4F8EhA/y8IAARPpEMHC68uFNgAfFQPTP/oA+kAh8AHtRND6APpA+kDUMFE2oVIqxwXy4sEowv/y4sJUNEJwVCATVBQDyFAE+gJYzxYBzxbMySLIywES9AD0AMsAySD5AHB0yMsCygfL/8nQBPpA9AQx+gAg10nCAPLixHeAGMjLBVAIzxZw+gIXy2sTzISwIBIExNAK6CEBeNRRnIyx8Zyz9QB/oCIs8WUAbPFiX6AlADzxbJUAXMI5FykXHiUAioE6CCCOThwKoAggiYloCgoBS88uLFBMmAQPsAECPIUAT6AljPFgHPFszJ7VQD9ztRND6APpA+kDUMAjTP/oAUVGgBfpA+kBTW8cFVHNtcFQgE1QUA8hQBPoCWM8WAc8WzMkiyMsBEvQA9ADLAMn5AHB0yMsCygfL/8nQUA3HBRyx8uLDCvoAUaihggiYloCCCJiWgBK2CKGCCOThwKAYoSfjDyXXCwHDACOBOT1AA2ztRND6APpA+kDUMAfTP/oA+kAwUVGhUknHBfLiwSfC//LiwoII5OHAqgAWoBa88uLDghB73ZfeyMsfFcs/UAP6AiLPFgHPFslxgBjIywUkzxZw+gLLaszJgED7AEATyFAE+gJYzxYBzxbMye1UgAHBSeaAYoYIQc2LQnMjLH1Iwyz9Y+gJQB88WUAfPFslxgBDIywUkzxZQBvoCFctqFMzJcfsAECQQIwAOEEkQODdfBAB2wgCwjiGCENUydttwgBDIywVQCM8WUAT6AhbLahLLHxLLP8ly+wCTNWwh4gPIUAT6AljPFgHPFszJ7VQCAWJSUwICzFRVAgN6YFxdAfXZBjgEkvgfAA6GmBgLjYSS+B8H0gfSAY/QAYuOuQ/QAY/QAYOdTaAAFpj+mf9qJofQB9IGpqGEAKqThdRxmampsbKJpjgvlwJIF9IH0AahgQaEAwa5D9ABgSiBooIXgGilAoGeQoAn0BLGeLZmZk9qpwQQg97svvKThdRWAJO78FCIBuCoQCaoKAeQoAn0BLGeLAOeLZmSRZGWAiXoAegBlgGSQfIA4OmRlgWUD5f/k6DvADGRlgqxniygCfQEJ5bWJZmZkuP2AQT0juA2NzcB+gD6QPgoVBIGcFQgE1QUA8hQBPoCWM8WAc8WzMkiyMsBEvQA9ADLAMn5AHB0yMsCygfL/8nQUAbHBfLgSqEDRUXIUAT6AljPFszMye1UAfpAMCDXCwHDAJFb4w3gghAsdrlzUnC64wI1NzcjwAPjAjUCwARXWFlaAD6CENUydttwgBDIywVQA88WIvoCEstqyx/LP8mAQvsAAf42XwOCCJiWgBWgFbzy4EsC+kDTADCVyCHPFsmRbeKCENFzVABwgBjIywVQBc8WJPoCFMtqE8sfFMs/I/pEMHC6jjP4KEQDcFQgE1QUA8hQBPoCWM8WAc8WzMkiyMsBEvQA9ADLAMn5AHB0yMsCygfL/8nQzxaWbCJwAcsB4vQAWwA0M1A1xwXy4EkD+kAwWchQBPoCWM8WzMzJ7VQAQo4YUSTHBfLgSdQwQwDIUAT6AljPFszMye1U4F8FhA/y8AAKyYBA+wAAfa289qJofQB9IGpqGDYY/BQAuCoQCaoKAeQoAn0BLGeLAOeLZmSRZGWAiXoAegBlgGT8gDg6ZGWBZQPl/+ToQAAfrxb2omh9AH0gamoYP6qQQA==`,
			expected: []any {
				big.NewInt(800000000000000000),
				big.NewInt(200000000000000000),
				big.NewInt(3000000000),
				big.NewInt(200000000000000000),
				big.NewInt(14900000000),
				big.NewInt(1000),
				big.NewInt(50000),
			},
		},
		{
			name: "get_ton_fun_factory_data",
			addr: addr.MustFromBase64("kQBf2Xc-07OLPlv4GNKQffy3rLuhRvXQQWLA7Dqiuh4kt5w4").MustToTonutils(),
			code: `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`,
			data: `te6ccgECXgEAE1QAA0WAD1Uy7olDGF9bGtFySIzrn0LZr3qp/xfYI7SRaXigkwZgGAECAwMACAkKAgHNBAUCAD4/AQFYBgEBSAcAAACHgBwELHuyqYexSPT5OLR78VkGoW/lA8kRsz0sqR4b8tGBcAMtxx7pJlbeWTf0y5snnnDm/wu34QGzrQRqnM3KsodDQCAAUICxorwuxQAACALGivC7FAAASy0F4AgCxorwuxQAAFA3gb9QAgPow1ABFP8A9KQT9LzyyAsLART/APSkE/S88sgLIwIBYgwNAgLKDg8CASAbHAIBIBARADGpVIyoFIioROoUyGooQKCEDuaygACqKmEgAgHOEkgCAnUZGgHxO2i7fsgxwCSXwTgAdDTAzH6QPpAMfoAMXHXIfoAMfoAMHOptAAC0x/TP+1E0PoAAfhh+gAB+GL6AAH4Y/oAAfhk+gAB+GX6AAH4ZtMPAfhn+gAB+GjTDwH4adMAAfhq1AHQ+kAB+Gv6QAH4bNQB+G3UMPhu1DD4b4BMDSIIQc2LQnFIwuuMAIoIQ7VkxNbrjAjQ0+EsSxwXjAl8EhA/y8BQVFgL++Cj4TPhNcFQgE1QUA8hQBPoCWM8WAc8WzMkiyMsBEvQA9ADLAMn5AHB0yMsCygfL/8nQUkDHBfLivvoA+kD4SsABjrkwMzQ1M3BZgEABECVwQGVwIIIQD4p+pcjLHxbLP1AD+gIhzxYBzxYTywAB+gLLAMkCcrFDMNs82zHg1D0pA4YyNfhKwAGOixRfBHCAQHKxEts84EMw+gD6APpA0wAlpwNSUKCCCmJaAKCCCJiWgKBScLmOjBB4XwhwgEBysRLbPOMONDQtA+gDMiKCEEEuGda6j2YwIYIQHpQjhrqOz1v4S/hHgEBysRLbPHD4Z/hP+E74Tcj4S88W+EzPFszMyfhK+En4R8j4QfoC+EL6AvhD+gL4RPoC+EX6AvhG+gLLD/hI+gLLD8sAzMzJ7VTgAYIQQqD7Q7rjAjDjDTQXGAFEggiYloD4R6D4QaBSELzy4FOCCJiWgPhHoPhBoKH4S3DbPDQAjmwh0w8w+Gf4T/hO+E3I+EvPFvhMzxbMzMn4SvhJ+EfI+EH6AvhC+gL4Q/oC+ET6AvhF+gL4RvoCyw/4SPoCyw/LAMzMye1UATUMYIQIc/gK8jLHxPLPwHPFsmCCvrwgFlx2zyA7ATkghCX1R8vyMsfFMs/Ac8WAc8WyYIK+vCAWXHbPIDsB57wwR2omh9AAD8MP0AAPwxfQAA/DH9AAD8Mn0AAPwy/QAA/DNph4D8M/0AAPw0aYeA/DTpgAD8NWoA6H0gAPw1/SAA/DZqAPw26hh8N2oYfDf8J7gpgGQoAueLEP0BCmWPkP0BCeWP5JFkZYCJegB6AGWAZMHQIBIB4fABr5AHB0yMsCygfL/8nQAgEgICEA0bsivtRND6AAH4YfoAAfhi+gAB+GP6AAH4ZPoAAfhl+gAB+GbTDwH4Z/oAAfho0w8B+GnTAAH4atQB0PpAAfhr+kAB+GzUAfht1DD4btQw+G/4QfhC+EP4RPhF+Eb4R/hI+En4SvhL+EyAHxtOYdqJofQAA/DD9AAD8MX0AAPwx/QAA/DJ9AAD8Mv0AAPwzaYeA/DP9AAD8NGmHgPw06YAA/DVqAOh9IAD8Nf0gAPw2agD8NuoYfDdqGHw3/COpCECTiFTCUPwhfCJQ/CD8ISkRVAFQ1IIpCFsEKQhQ0Pwg/CERLMCIAzbXWfaiaH0AAPww/QAA/DF9AAD8Mf0AAPwyfQAA/DL9AAD8M2mHgPwz/QAA/DRph4D8NOmAAPw1agDofSAA/DX9IAD8NmoA/DbqGHw3ahh8N/whfCCRLKkQVAFQVIJ8IXwgqoER+BLAAIFIgqAKgqQT4QfhCVQIj8CUCAWIkJQPg0CDHAJJfBOAB0NMDMfpAMAHTH9M/Me1E0PpAAfhh+gAB+GLTHwH4Y/oAAfhk0x8w+GUhghCjQaFwuuMCMDKCELL3e0T+IDCCELL3e0T+IDCCAeDz/iAwIYIQsvd7RLrjAjCCEEKg+0O64wIwhA/y8CYnKABJofXV2omh9IAD8MP0AAPwxaY+A/DH9AAD8MmmPmHwy/CD8IXwhwCCNFsB+gAwgggHoSBSEKASvPLixfhDpPhj+EIhoPhi+EWk+GX4RAGg+GT4RfhDyPhBzxb4QvoCyx/4RPoCyx/J7VQBZGwh+EHHBfLgSfhB+EKAQHKxEts8cPhicPhj+EX4Q8j4Qc8W+EL6Assf+ET6Assfye1UNAEyIIIImJaAvPLgU/hBAYIImJaAoXBysRLbPDQD/gHQI8IA8uLC0x8hghDUcAxBuo9iNls1NTUi8AFDAAH6APpAMPhC+EElWVIgqAKgqQRSA7n4QfhDoVIwvLGOs1twWYBAARAlcEBlcCCCEA+KfqXIyx8Wyz9QA/oCIc8WAc8WE8sAAfoCywDJAnKxQzDbPOMO2zHgM4IQTgvQILo9KisDuDI0UwNxcrES2zxwgEBysRLbPPhBI6H4YfhCIaD4YoIQTohCkEEz+ErI+EH6AvhC+gLLAMnIUAT6Alj6AgHPFszJcIMHcYAMyMsDywHLCFIwy//LYRLLH8zJcPsANDQsA7yP2TAzMzX6APoAUyGgFL7y4yP4Qlig+GL4RQGg+GXTAAGPNNQw0PpAQzD6APoA+kDTACWnA1JQoIIKYloAoIIImJaAoFJwuY6MEHhfCHCAQHKxEts84w6SXwTi4GwhNC0uAID4T/hO+E3I+EvPFvhMzxbMzMn4SvhJ+EfI+EH6AvhC+gL4Q/oC+ET6AvhF+gL4RvoCyw/4SPoCyw/LAMzMye1UA+b4R1JQgScQqYQimfhJUhCBJxCphJFw4mahU2Ch+EL4RKH4QfhCUiKoAqGpBFIQtghSEKFmofhB+EIiWVIgqAKgqQRSCbn4QvhEoVKQvLGOjBC8XwxwgEBysRLbPOAFkzhsIeMNUGShggiYloCh+Cj4TPhNNC8wAIT4T/hO+E3I+EvPFvhMzxbMzMn4SvhJ+EfI+EH6AvhC+gL4Q/oC+ET6AvhF+gL4RvoCyw/4SPoCyw/LAMzMye1U2zEBqgP6QDD4T3BTAMhQBc8WIfoCFMsfIfoCE8sfySLIywES9AD0AMsAySD5AHB0yMsCygfL/8nQUjqhgggtxsChghCjQaFwyMsfUtDLPwH6AskQKXDbPAUxAvxwVCATVBQDyFAE+gJYzxYBzxbMySLIywES9AD0AMsAyfkAcHTIywLKB8v/ydBwKQRDEyVZECVwQGVwIIIQD4p+pcjLHxbLP1AD+gIhzxYBzxYTywAB+gLLAMkCcrFDMNs8+EEkoPhh+EIhofhi+EhYoPho+EH4RoBQgGSphL49MgAud4AYyMsFUAXPFlAF+gITy2vMzMkB+wAD/o5O+E7Q0wfTACLAAgLAABKwjjn6QPpA+kD4TPpEccjLAxLLB8v/ydBUegEn8BpUGgol8BtxBMjLBxTLAFjPFgHPFgHPFlAFzxbJ+G6SWzTikTTi+EH4Rr74QvhEoYIQO5rKALuw4wAgwgCOiFIgcHKxEts8kTDighAjtJdhQTMzNDUCSo8i7aLt+3H4avhO0NMHIcABjoMx2zyOiwHAAo6E2zzbMeAw4tg2NwAocIAYyMsFUAPPFlAD+gLLaskB+wAA7PhKyPhB+gL4QvoCywDJyFAE+gJY+gIBzxbMyXCDB3GADMjLA8sBywhSMMv/y2ESyx/MyXD7APhP+E74Tcj4S88W+EzPFszMyfhK+En4R8j4QfoC+EL6AvhD+gL4RPoC+EX6AvhG+gLLD/hI+gLLD8sAzMzJ7VQB8vpA+kAw+Ez4TSNZcFQgE1QUA8hQBPoCWM8WAc8WzMkiyMsBEvQA9ADLAMn5AHB0yMsCygfL/8nQ+EH4Q6H4Rfgo+Ez4TXBUIBNUFAPIUAT6AljPFgHPFszJIsjLARL0APQAywDJ+QBwdMjLAsoHy//J0HAlRBNUR2A4Aaz6QDH6QPpA+Eb4Q6H4RfhM+kRxyMsDEssHy//J0Pgo+Ez4TXBUIBNUFAPIUAT6AljPFgHPFszJIsjLARL0APQAywDJ+QBwdMjLAsoHy//J0FRjMFRmSjoCmoIQ/Pnlj8jLH1jPFgH6AsmCEAjw0YBSMKCCCvrwgKBtcCCCEA+KfqXIyx/LP1AG+gJQBM8WFMsBEvQAghAI8NGA+gL0AMkScds8QTNxPTkBjoIQ/Pnlj8jLH1jPFgH6AsmCEAjw0YCCCvrwgKBtcCCCEA+KfqXIyx/LP1AG+gJQBM8WFMsBEvQAghAI8NGA+gL0AMkScds8PQKOyHH6AiX6AlAE+gLJghAI8NGAUlCgggr68ICgbW1wIIIQ1V5GhsjLH8s/UAn6AhjLAFAFzxZQA88WzBT0APQAyXHbPEVAQTA7PAAscYAQyMsFUATPFlAE+gISy2rMyQH7AAG4ghAI8NGAggr68ICgcFMAghBA4QjWyMsfywBQBc8WUAPPFnH6AlAH+gIl+gISywHLAcltcCCCEA+KfqXIyx/LP1AG+gJQA88WFMsB9ACCEAjw0YD6AhL0AMlx2zw9ACxxgBjIywVQBM8WUAT6AhLLaszJAfsAART/APSkE/S88sgLQAEU/wD0pBP0vPLIC1ECAWJBQgICy0NEABug9gXaiaH0AfSB9IGoYQIBIEVGAIPSAINch7UTQ+gD6QPpA1DAE0x+CEBeNRRlSILqCEHvdl94TuhKx8uLF0z8x+gAwE6BQI8hQBPoCWM8WAc8WzMntVICAdRHSAIBWElKAMMIMcAkl8E4AHQ0wMBcbCVE18D8BDg+kD6QDH6ADFx1yH6ADH6ADBzqbQAAtMfghAPin6lUiC6lTE0WfAN4IIQF41FGVIgupYxREQD8A7gNYIQWV8HvLqTWfAP4F8EhA/y8IAARPpEMHC68uFNgAfFQPTP/oA+kAh8AHtRND6APpA+kDUMFE2oVIqxwXy4sEowv/y4sJUNEJwVCATVBQDyFAE+gJYzxYBzxbMySLIywES9AD0AMsAySD5AHB0yMsCygfL/8nQBPpA9AQx+gAg10nCAPLixHeAGMjLBVAIzxZw+gIXy2sTzISwIBIExNAK6CEBeNRRnIyx8Zyz9QB/oCIs8WUAbPFiX6AlADzxbJUAXMI5FykXHiUAioE6CCCOThwKoAggiYloCgoBS88uLFBMmAQPsAECPIUAT6AljPFgHPFszJ7VQD9ztRND6APpA+kDUMAjTP/oAUVGgBfpA+kBTW8cFVHNtcFQgE1QUA8hQBPoCWM8WAc8WzMkiyMsBEvQA9ADLAMn5AHB0yMsCygfL/8nQUA3HBRyx8uLDCvoAUaihggiYloCCCJiWgBK2CKGCCOThwKAYoSfjDyXXCwHDACOBOT1AA2ztRND6APpA+kDUMAfTP/oA+kAwUVGhUknHBfLiwSfC//LiwoII5OHAqgAWoBa88uLDghB73ZfeyMsfFcs/UAP6AiLPFgHPFslxgBjIywUkzxZw+gLLaszJgED7AEATyFAE+gJYzxYBzxbMye1UgAHBSeaAYoYIQc2LQnMjLH1Iwyz9Y+gJQB88WUAfPFslxgBDIywUkzxZQBvoCFctqFMzJcfsAECQQIwAOEEkQODdfBAB2wgCwjiGCENUydttwgBDIywVQCM8WUAT6AhbLahLLHxLLP8ly+wCTNWwh4gPIUAT6AljPFgHPFszJ7VQCAWJSUwICzFRVAgN6YFxdAfXZBjgEkvgfAA6GmBgLjYSS+B8H0gfSAY/QAYuOuQ/QAY/QAYOdTaAAFpj+mf9qJofQB9IGpqGEAKqThdRxmampsbKJpjgvlwJIF9IH0AahgQaEAwa5D9ABgSiBooIXgGilAoGeQoAn0BLGeLZmZk9qpwQQg97svvKThdRWAJO78FCIBuCoQCaoKAeQoAn0BLGeLAOeLZmSRZGWAiXoAegBlgGSQfIA4OmRlgWUD5f/k6DvADGRlgqxniygCfQEJ5bWJZmZkuP2AQT0juA2NzcB+gD6QPgoVBIGcFQgE1QUA8hQBPoCWM8WAc8WzMkiyMsBEvQA9ADLAMn5AHB0yMsCygfL/8nQUAbHBfLgSqEDRUXIUAT6AljPFszMye1UAfpAMCDXCwHDAJFb4w3gghAsdrlzUnC64wI1NzcjwAPjAjUCwARXWFlaAD6CENUydttwgBDIywVQA88WIvoCEstqyx/LP8mAQvsAAf42XwOCCJiWgBWgFbzy4EsC+kDTADCVyCHPFsmRbeKCENFzVABwgBjIywVQBc8WJPoCFMtqE8sfFMs/I/pEMHC6jjP4KEQDcFQgE1QUA8hQBPoCWM8WAc8WzMkiyMsBEvQA9ADLAMn5AHB0yMsCygfL/8nQzxaWbCJwAcsB4vQAWwA0M1A1xwXy4EkD+kAwWchQBPoCWM8WzMzJ7VQAQo4YUSTHBfLgSdQwQwDIUAT6AljPFszMye1U4F8FhA/y8AAKyYBA+wAAfa289qJofQB9IGpqGDYY/BQAuCoQCaoKAeQoAn0BLGeLAOeLZmSRZGWAiXoAegBlgGT8gDg6ZGWBZQPl/+ToQAAfrxb2omh9AH0gamoYP6qQQA==`,
			expected: []any {
				addr.MustFromBase64("EQB6qZd0ShjC-tjWi5JEZ1z6Fs171U_4vsEdpItLxQSYM5eb").MustToTonutils(),
				big.NewInt(0),
				big.NewInt(0),
			},
		},
	}

	for _, test := range testCases {
		ret := execGetMethod(t, i, test.addr, test.name, test.code, test.data)
		// fmt.Println(ret);
		require.Equal(t, test.expected, ret)
	}
}

func TestGetMethodDesc_Tonfun(t *testing.T) {
	var (
		interfaces []*abi.InterfaceDesc
		i          *abi.InterfaceDesc
	)

	j, err := os.ReadFile("tonfun.json")
	require.Nil(t, err)

	err = json.Unmarshal(j, &interfaces)
	require.Nil(t, err)

	for _, i = range interfaces {
		if i.Name == "tonfun" {
			err := abi.RegisterDefinitions(i.Definitions)
			require.Nil(t, err)
			break
		}
	}
	
	var testCases = []*struct {
		name string
		addr *address.Address
		code string
		data string
		expected []any
	} {
		{
			name: "get_ton_fun_data",
			addr: addr.MustFromBase64("kQA8aU596AiP5WxSuE98UZ7pNbjVWvXl_82WWfzBG9I42JO_").MustToTonutils(),
			code: `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`,
			data: `te6ccgECHQEABQYAAllLLQXgCA3gtrOnZAAASy0F4AgCxorwuxQAAIAsaK8LsUAABQN4G/UAA+gMNQQBAgKFgAv7LufadnFny38DGlIPv5b1l3Qo3roILFgdh1RXQ8SW8ALdZWdtZGh+cVVmwGA2W8oyL6dWFWPN0/whDh8DMaHf6gMEART/APSkE/S88sgLFgEU/wD0pBP0vPLICwUAAAIBYgYHAgLLCAkAG6D2BdqJofQB9IH0gahhAgEgCgsAg9IAg1yHtRND6APpA+kDUMATTH4IQF41FGVIguoIQe92X3hO6ErHy4sXTPzH6ADAToFAjyFAE+gJYzxYBzxbMye1UgIB1AwNAgFYDg8AwwgxwCSXwTgAdDTAwFxsJUTXwPwEOD6QPpAMfoAMXHXIfoAMfoAMHOptAAC0x+CEA+KfqVSILqVMTRZ8A3gghAXjUUZUiC6ljFERAPwDuA1ghBZXwe8upNZ8A/gXwSED/LwgABE+kQwcLry4U2AB8VA9M/+gD6QCHwAe1E0PoA+kD6QNQwUTahUirHBfLiwSjC//LiwlQ0QnBUIBNUFAPIUAT6AljPFgHPFszJIsjLARL0APQAywDJIPkAcHTIywLKB8v/ydAE+kD0BDH6ACDXScIA8uLEd4AYyMsFUAjPFnD6AhfLaxPMgQAgEgERIAroIQF41FGcjLHxnLP1AH+gIizxZQBs8WJfoCUAPPFslQBcwjkXKRceJQCKgToIII5OHAqgCCCJiWgKCgFLzy4sUEyYBA+wAQI8hQBPoCWM8WAc8WzMntVAP3O1E0PoA+kD6QNQwCNM/+gBRUaAF+kD6QFNbxwVUc21wVCATVBQDyFAE+gJYzxYBzxbMySLIywES9AD0AMsAyfkAcHTIywLKB8v/ydBQDccFHLHy4sMK+gBRqKGCCJiWgIIImJaAErYIoYII5OHAoBihJ+MPJdcLAcMAI4BMUFQDbO1E0PoA+kD6QNQwB9M/+gD6QDBRUaFSSccF8uLBJ8L/8uLCggjk4cCqABagFrzy4sOCEHvdl97Iyx8Vyz9QA/oCIs8WAc8WyXGAGMjLBSTPFnD6AstqzMmAQPsAQBPIUAT6AljPFgHPFszJ7VSAAcFJ5oBihghBzYtCcyMsfUjDLP1j6AlAHzxZQB88WyXGAEMjLBSTPFlAG+gIVy2oUzMlx+wAQJBAjAA4QSRA4N18EAHbCALCOIYIQ1TJ223CAEMjLBVAIzxZQBPoCFstqEssfEss/yXL7AJM1bCHiA8hQBPoCWM8WAc8WzMntVAIBYhcYA+DQIMcAkl8E4AHQ0wMx+kAwAdMf0z8x7UTQ+kAB+GH6AAH4YtMfAfhj+gAB+GTTHzD4ZSGCEKNBoXC64wIwMoIQsvd7RP4gMIIQsvd7RP4gMIIB4PP+IDAhghCy93tEuuMCMIIQQqD7Q7rjAjCED/LwGRobAEmh9dXaiaH0gAPww/QAA/DFpj4D8Mf0AAPwyaY+YfDL8IPwhfCHAII0WwH6ADCCCAehIFIQoBK88uLF+EOk+GP4QiGg+GL4RaT4ZfhEAaD4ZPhF+EPI+EHPFvhC+gLLH/hE+gLLH8ntVAFkbCH4QccF8uBJ+EH4QoBAcrES2zxw+GJw+GP4RfhDyPhBzxb4QvoCyx/4RPoCyx/J7VQcATIgggiYloC88uBT+EEBggiYloChcHKxEts8HAAocIAYyMsFUAPPFlAD+gLLaskB+wA=`,
			expected: []any {
				big.NewInt(3000000000),
				big.NewInt(1000000000000000000),
				big.NewInt(3000000000),
				big.NewInt(200000000000000000),
				big.NewInt(200000000000000000),
				big.NewInt(14900000000),
				big.NewInt(1000),
				big.NewInt(0),
				big.NewInt(50000),
				big.NewInt(0),
				addr.MustFromBase64("EQBf2Xc-07OLPlv4GNKQffy3rLuhRvXQQWLA7Dqiuh4ktyey").MustToTonutils(),
				addr.MustFromBase64("EQC3WVnbWRofnFVZsBgNlvKMi-nVhVjzdP8IQ4fAzGh3-v5T").MustToTonutils(),
			},
		},
	}

	for _, test := range testCases {
		ret := execGetMethod(t, i, test.addr, test.name, test.code, test.data)
		// fmt.Print(ret)
		require.Equal(t, test.expected, ret)
	}
}

func TestOperationDesc_TonfunFactory(t *testing.T) {
	var (
		interfaces []*abi.InterfaceDesc
		i          *abi.InterfaceDesc
	)

	j, err := os.ReadFile("tonfun.json")
	require.Nil(t, err)

	err = json.Unmarshal(j, &interfaces)
	require.Nil(t, err)

	for _, i = range interfaces {
		if i.Name == "tonfun_factory" {
			err := abi.RegisterDefinitions(i.Definitions)
			require.Nil(t, err)
			break
		}
	}

	var testCases = []*struct {
		name     string
		boc      string
		expected string
	}{
		{
			name:     `create_ton_fun_success`,
			boc:      `te6cckEBAgEAbgABCAoIhVwBAMmAGZVLanby5XtjYZyV+1h/YRPWh4RHlLwJTwPqcq0yP08wA6nDLQpSEiOyddsSjrjJkRm51M4513WzYwoRA9FV5r1WACV8I4JKP9O+CiVULVC0LiiGKtt71IrJnkdoGYv13e7NQJ/1VLY=`,
			expected: `{"data":{"creator":"EQDMqltTt5cr2xsM5K_aw_sInrQ8Ijyl4Ep4H1OVaZH6efgU","ton_fun_address":"EQDqcMtClISI7J12xKOuMmRGbnUzjnXdbNjChED0VXmvVaex","jetton_master_address":"EQBK-EcElH-nfBRKqFqhaFxRDFW296kVkzyO0DMX67vdmko-"}}`,
		},
	}

	for _, test := range testCases {
		j := loadOperation(t, i, test.name, test.boc)
		require.Equal(t, test.expected, j)
	}
}

func TestOperationDesc_Tonfun(t *testing.T) {
	var (
		interfaces []*abi.InterfaceDesc
		i          *abi.InterfaceDesc
	)

	j, err := os.ReadFile("tonfun.json")
	require.Nil(t, err)

	err = json.Unmarshal(j, &interfaces)
	require.Nil(t, err)

	for _, i = range interfaces {
		if i.Name == "tonfun" {
			err := abi.RegisterDefinitions(i.Definitions)
			require.Nil(t, err)
			break
		}
	}

	var testCases = []*struct {
		name     string
		boc      string
		expected string
	}{
		// {
		// 	name: `buy_jetton_success`,
		// 	boc: `te6cckEBAwEASAABCCO0l2EBAVtDuLh8BxvWIClwvMWAAIdVaP0xUNB/vAwsflbhFLo6AflbG1QXPURgp2Si3SMQAgAcUXoaJR94CvBHPi7d8HUYE6SL`,
		// 	expected: `{"data":{"amount_in":"999000000","amount_out":"7835257993739461","sender_address":"EQAEOqtH6YqGg_3gYWPytwil0dAPytjaoLnqIwU7JRbpGLnL","reserve_data":{"reserve_0":"101496017399","reserve_1":"788208267189678197"}}}`,
		// },
		// {
		// 	name: `sell_jetton_success`,
		// 	boc: `te6cckEBAwEASAABCE6IQpABAVtw4OZJQBUsZB3rpYmAGZVLanby5XtjYZyV+1h/YRPWh4RHlLwJTwPqcq0yP08wAgAcUXZhbKN4CwwdXlhOrTqzMtQV`,
		// 	expected: `{"data":{"amount_in":"3956474816582342","amount_out":"501982601","sender_address":"EQDMqltTt5cr2xsM5K_aw_sInrQ8Ijyl4Ep4H1OVaZH6efgU","reserve_data":{"reserve_0":"100497017399","reserve_1":"796043525183417658"}}}`,
		// },
	}

	for _, test := range testCases {
		j := loadOperation(t, i, test.name, test.boc)
		require.Equal(t, test.expected, j)
	}
}
